<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RTSP Monitor - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: white;
            overflow-x: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 1.8em;
            color: #ecf0f1;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 14px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .info-panel {
            background: rgba(52, 73, 94, 0.9);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .system-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .controls-panel {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.2s;
        }
        
        .control-btn:hover {
            background: #2980b9;
        }
        
        .control-btn.danger {
            background: #e74c3c;
        }
        
        .control-btn.danger:hover {
            background: #c0392b;
        }
        
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
            padding: 20px;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }
        
        .camera-item {
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #34495e;
            transition: all 0.3s ease;
        }
        
        .camera-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }
        
        .camera-header {
            background: #34495e;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .camera-title {
            font-weight: bold;
            color: #3498db;
        }
        
        .camera-info {
            font-size: 12px;
            color: #bdc3c7;
        }
        
        .camera-status {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 3px;
            background: #95a5a6;
            color: white;
        }
        
        .camera-status.online {
            background: #27ae60;
        }
        
        .camera-status.loading {
            background: #f39c12;
            animation: pulse 1s infinite;
        }
        
        .camera-status.error {
            background: #e74c3c;
        }
        
        .video-container {
            height: 280px;
            background: #34495e;
            position: relative;
            overflow: hidden;
        }
        
        .camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #bdc3c7;
            text-align: center;
            padding: 20px;
        }
        
        .camera-icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.6;
        }
        
        .camera-controls {
            padding: 12px 15px;
            background: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .controls-left {
            display: flex;
            gap: 8px;
        }
        
        .controls-right {
            font-size: 11px;
            color: #95a5a6;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .btn.stop {
            background: #e74c3c;
        }
        
        .btn.stop:hover {
            background: #c0392b;
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: #27ae60;
        }
        
        .notification.error {
            background: #e74c3c;
        }
        
        .notification.warning {
            background: #f39c12;
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–∏—Å—Ç–µ–º—ã -->
    <div class="header">
        <h1>üé• RTSP Monitor - –°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è</h1>
        <div class="header-info">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞</span>
            </div>
            <div>–ö–∞–º–µ—Ä: <span id="totalCameras">0</span></div>
            <div>–ê–∫—Ç–∏–≤–Ω–æ: <span id="activeCameras">0</span></div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="info-panel">
        <div class="system-info">
            <div>üé¨ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π MJPEG –¥–µ–∫–æ–¥–µ—Ä</div>
            <div>üì° –ü—Ä—è–º–æ–µ RTSP –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div>‚ö° –ù–µ—Ç –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫</div>
        </div>
        <div class="controls-panel">
            <button class="control-btn" onclick="startAllStreams()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <button class="control-btn danger" onclick="stopAllStreams()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ</button>
            <button class="control-btn" onclick="refreshCameras()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- –°–µ—Ç–∫–∞ –∫–∞–º–µ—Ä -->
    <div class="camera-grid" id="cameraGrid">
        <!-- –ö–∞–º–µ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let cameras = [];
        let activeStreams = new Map();
        let systemStats = {
            total: 0,
            active: 0,
            startTime: Date.now()
        };

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
         */
        async function initializeSystem() {
            console.log('üé• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è RTSP Monitor...');
            
            try {
                await loadCameras();
                updateStats();
                showNotification('–°–∏—Å—Ç–µ–º–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã', 'error');
            }
        }

        /**
         * –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä
         */
        async function loadCameras() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–∞–º–µ—Ä...');
                const response = await fetch('/api/cameras');
                cameras = await response.json();
                
                console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${cameras.length} –∫–∞–º–µ—Ä:`, cameras);
                
                systemStats.total = cameras.length;
                renderCameras();
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–º–µ—Ä:', error);
                throw error;
            }
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä –≤ —Å–µ—Ç–∫–µ
         */
        function renderCameras() {
            const grid = document.getElementById('cameraGrid');
            grid.innerHTML = '';

            cameras.forEach(camera => {
                const cameraElement = createCameraElement(camera);
                grid.appendChild(cameraElement);
            });

            console.log(`‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ ${cameras.length} –∫–∞–º–µ—Ä –≤ —Å–µ—Ç–∫–µ`);
        }

        /**
         * –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∫–∞–º–µ—Ä—ã
         */
        function createCameraElement(camera) {
            const cameraDiv = document.createElement('div');
            cameraDiv.className = 'camera-item';
            cameraDiv.id = `camera-${camera.id}`;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–∞–º–µ—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const cameraType = camera.rtsp_main.includes('185.70.184.101') ? '–¢–µ—Å—Ç–æ–≤–∞—è (—Ä–∞–±–æ—á–∞—è)' : 'Hikvision';
            const networkInfo = camera.rtsp_main.includes('192.168') ? 
                `–°–µ—Ç—å: ${camera.rtsp_main.match(/192\.168\.\d+\.\d+/)?.[0] || '–ª–æ–∫–∞–ª—å–Ω–∞—è'}` : 
                '–í–Ω–µ—à–Ω—è—è –∫–∞–º–µ—Ä–∞';
            
            cameraDiv.innerHTML = `
                <div class="camera-header">
                    <div>
                        <div class="camera-title">${camera.camera_name}</div>
                        <div class="camera-info">${camera.apartment_name} ‚Ä¢ ${cameraType}</div>
                    </div>
                    <div class="camera-status" id="status-${camera.id}">–ì–æ—Ç–æ–≤</div>
                </div>
                
                <div class="video-container">
                    <div class="placeholder" id="placeholder-${camera.id}">
                        <div class="camera-icon">üìπ</div>
                        <div style="margin-bottom: 10px;"><strong>${camera.camera_name}</strong></div>
                        <div style="font-size: 12px; opacity: 0.8;">${networkInfo}</div>
                        <div style="font-size: 11px; margin-top: 5px; opacity: 0.6;">
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ RTSP –ø–æ—Ç–æ–∫–∞
                        </div>
                    </div>
                    <img class="camera-video" id="video-${camera.id}" style="display: none;">
                </div>
                
                <div class="camera-controls">
                    <div class="controls-left">
                        <button class="btn" onclick="startCameraStream(${camera.id}, 'sub')" id="btn-480p-${camera.id}">
                            üì∫ 480p
                        </button>
                        <button class="btn" onclick="startCameraStream(${camera.id}, 'main')" id="btn-1080p-${camera.id}">
                            üñ•Ô∏è 1080p
                        </button>
                        <button class="btn stop" onclick="stopCameraStream(${camera.id})" id="btn-stop-${camera.id}" disabled>
                            ‚èπÔ∏è –°—Ç–æ–ø
                        </button>
                    </div>
                    <div class="controls-right" id="info-${camera.id}">
                        –ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é
                    </div>
                </div>
            `;
            
            return cameraDiv;
        }

        /**
         * –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –∫–∞–º–µ—Ä—ã
         */
        async function startCameraStream(cameraId, quality) {
            const camera = cameras.find(c => c.id === cameraId);
            if (!camera) {
                console.error('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', cameraId);
                return;
            }

            console.log(`üì° –ó–∞–ø—É—Å–∫ RTSP –ø–æ—Ç–æ–∫–∞: ${camera.camera_name} (${quality})`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateCameraStatus(cameraId, 'loading', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
            updateCameraPlaceholder(cameraId, 'loading', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RTSP –ø–æ—Ç–æ–∫—É...');
            disableCameraButtons(cameraId, true);
            
            try {
                const rtspUrl = quality === 'main' ? camera.rtsp_main : camera.rtsp_sub;
                
                const response = await fetch('/api/stream/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cameraId,
                        rtspUrl,
                        quality
                    })
                });

                const result = await response.json();

                if (result.success) {
                    console.log(`‚úÖ –ü–æ—Ç–æ–∫ –∑–∞–ø—É—â–µ–Ω: ${result.streamId}`);
                    console.log(`üåê MJPEG URL: ${result.url}`);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Ç–æ–∫–µ
                    activeStreams.set(cameraId, {
                        streamId: result.streamId,
                        url: result.url,
                        quality,
                        camera,
                        startTime: Date.now()
                    });
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É (–≤—Ä–µ–º—è –Ω–∞ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é)
                    setTimeout(() => {
                        displayCameraVideo(cameraId, result.url, quality);
                    }, 1000);
                    
                } else {
                    throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç–æ–∫–∞ ${camera.camera_name}:`, error);
                updateCameraStatus(cameraId, 'error', '–û—à–∏–±–∫–∞');
                updateCameraPlaceholder(cameraId, 'error', `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
                disableCameraButtons(cameraId, false);
                
                showNotification(`–û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã ${camera.camera_name}: ${error.message}`, 'error');
            }
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–µ–æ –∫–∞–º–µ—Ä—ã
         */
        function displayCameraVideo(cameraId, videoUrl, quality) {
            const placeholder = document.getElementById(`placeholder-${cameraId}`);
            const video = document.getElementById(`video-${cameraId}`);
            
            if (placeholder && video) {
                console.log(`üé¨ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–µ–æ: –∫–∞–º–µ—Ä–∞ ${cameraId}, URL: ${videoUrl}`);
                
                video.src = videoUrl;
                video.style.display = 'block';
                placeholder.style.display = 'none';
                
                updateCameraStatus(cameraId, 'online', '–û–Ω–ª–∞–π–Ω');
                updateCameraInfo(cameraId, `${quality.toUpperCase()} –ø–æ—Ç–æ–∫ ‚Ä¢ MJPEG`);
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É —Å—Ç–æ–ø, –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
                document.getElementById(`btn-stop-${cameraId}`).disabled = false;
                document.getElementById(`btn-480p-${cameraId}`).disabled = true;
                document.getElementById(`btn-1080p-${cameraId}`).disabled = true;
                
                systemStats.active = activeStreams.size;
                updateStats();
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∏–¥–µ–æ
                video.onerror = () => {
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –¥–ª—è –∫–∞–º–µ—Ä—ã ${cameraId}`);
                    stopCameraStream(cameraId);
                    showNotification(`–û—à–∏–±–∫–∞ –≤–∏–¥–µ–æ –ø–æ—Ç–æ–∫–∞ –∫–∞–º–µ—Ä—ã ${cameraId}`, 'error');
                };
                
                console.log(`‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–º–µ—Ä—ã ${cameraId}`);
            }
        }

        /**
         * –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –∫–∞–º–µ—Ä—ã
         */
        async function stopCameraStream(cameraId) {
            const streamData = activeStreams.get(cameraId);
            if (!streamData) {
                console.warn(`‚ö†Ô∏è –ü–æ—Ç–æ–∫ –∫–∞–º–µ—Ä—ã ${cameraId} –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω`);
                return;
            }

            console.log(`üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞: ${streamData.streamId}`);
            
            try {
                const response = await fetch('/api/stream/stop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ streamId: streamData.streamId })
                });

                const result = await response.json();

                if (result.success) {
                    console.log(`‚úÖ –ü–æ—Ç–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: ${streamData.streamId}`);
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
                    const video = document.getElementById(`video-${cameraId}`);
                    const placeholder = document.getElementById(`placeholder-${cameraId}`);
                    
                    if (video && placeholder) {
                        video.src = '';
                        video.style.display = 'none';
                        placeholder.style.display = 'block';
                    }
                    
                    updateCameraStatus(cameraId, '', '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    updateCameraPlaceholder(cameraId, 'stopped', '–ü–æ—Ç–æ–∫ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    updateCameraInfo(cameraId, '–ì–æ—Ç–æ–≤ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É');
                    disableCameraButtons(cameraId, false);
                    
                    activeStreams.delete(cameraId);
                    systemStats.active = activeStreams.size;
                    updateStats();
                    
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏');
                }
                
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞:`, error);
                showNotification(`–û—à–∏–±–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞: ${error.message}`, 'error');
            }
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–º–µ—Ä—ã
         */
        function updateCameraStatus(cameraId, status, text) {
            const statusEl = document.getElementById(`status-${cameraId}`);
            if (statusEl) {
                statusEl.className = `camera-status ${status}`;
                statusEl.textContent = text;
            }
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–ª—É—à–∫–∏ –∫–∞–º–µ—Ä—ã
         */
        function updateCameraPlaceholder(cameraId, type, message) {
            const placeholder = document.getElementById(`placeholder-${cameraId}`);
            if (!placeholder) return;
            
            let icon = 'üìπ';
            let additionalContent = '';
            
            switch (type) {
                case 'loading':
                    icon = '';
                    additionalContent = '<div class="loading-spinner"></div>';
                    break;
                case 'error':
                    icon = '‚ö†Ô∏è';
                    break;
                case 'stopped':
                    icon = '‚èπÔ∏è';
                    break;
            }
            
            placeholder.innerHTML = `
                ${additionalContent}
                ${icon ? `<div class="camera-icon">${icon}</div>` : ''}
                <div>${message}</div>
            `;
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–º–µ—Ä–µ
         */
        function updateCameraInfo(cameraId, info) {
            const infoEl = document.getElementById(`info-${cameraId}`);
            if (infoEl) {
                infoEl.textContent = info;
            }
        }

        /**
         * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏ –∫–∞–º–µ—Ä—ã
         */
        function disableCameraButtons(cameraId, disabled) {
            const buttons = [
                document.getElementById(`btn-480p-${cameraId}`),
                document.getElementById(`btn-1080p-${cameraId}`)
            ];
            
            buttons.forEach(btn => {
                if (btn) btn.disabled = disabled;
            });
            
            const stopBtn = document.getElementById(`btn-stop-${cameraId}`);
            if (stopBtn) stopBtn.disabled = !disabled;
        }

        /**
         * –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
         */
        async function startAllStreams() {
            console.log('üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–∞–º–µ—Ä –≤ –∫–∞—á–µ—Å—Ç–≤–µ 480p...');
            showNotification('–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–∞–º–µ—Ä...', 'success');
            
            for (let i = 0; i < cameras.length; i++) {
                setTimeout(() => {
                    startCameraStream(cameras[i].id, 'sub');
                }, i * 1000); // –ó–∞–ø—É—Å–∫–∞–µ–º —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 1 —Å–µ–∫—É–Ω–¥–∞
            }
        }

        /**
         * –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
         */
        async function stopAllStreams() {
            console.log('üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤...');
            showNotification('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤...', 'warning');
            
            const activeIds = Array.from(activeStreams.keys());
            for (const cameraId of activeIds) {
                await stopCameraStream(cameraId);
            }
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä
         */
        async function refreshCameras() {
            console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞–º–µ—Ä...');
            showNotification('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 'success');
            
            try {
                await loadCameras();
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–º–µ—Ä', 'error');
            }
        }

        /**
         * –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
         */
        function updateStats() {
            document.getElementById('totalCameras').textContent = systemStats.total;
            document.getElementById('activeCameras').textContent = systemStats.active;
        }

        /**
         * –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
         */
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
            
            console.log(`üì¢ ${type.toUpperCase()}: ${message}`);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üé• RTSP Monitor - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            initializeSystem();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            updateStats();
        }, 10000);
    </script>
</body>
</html>
